<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Elevation Tile Downloader</title>
<link rel="stylesheet" href="leaflet.css" />
<style>#map{height:90vh;width:100%;}</style>
<script src="leaflet.js"></script>
</head>
<body>
<h3>Click two points to select an area. Set zoom level and tiles will download.</h3>
Zoom: <input id="zoom" type="number" value="10" min="0" max="15" />
<div id="map"></div>
<script>
var map = L.map('map').setView([0,0],2);
L.tileLayer('/tiles/{z}/{x}/{y}.jpg',{maxZoom:19}).addTo(map);
var marker1=null, marker2=null, rect=null;
function onMapClick(e){
    if(!marker1){
        marker1=L.marker(e.latlng).addTo(map);
    }else if(!marker2){
        marker2=L.marker(e.latlng).addTo(map);
        rect=L.rectangle([marker1.getLatLng(), marker2.getLatLng()],{color:'red'}).addTo(map);
        var z=document.getElementById('zoom').value;
        var url=`/download?z=${z}&lat1=${marker1.getLatLng().lat}&lon1=${marker1.getLatLng().lng}&lat2=${marker2.getLatLng().lat}&lon2=${marker2.getLatLng().lng}`;
        fetch(url).then(r=>r.json()).then(d=>alert('Downloaded '+d.downloaded+' tiles'));
    }else{
        map.removeLayer(marker1);map.removeLayer(marker2);map.removeLayer(rect);
        marker1=marker2=rect=null;
    }
}
map.on('click', onMapClick);
</script>
</body>
</html>
